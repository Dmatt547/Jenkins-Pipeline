pipeline {
    agent any
    environment {
        DIRECTORY_PATH = 'C:\\Users\\danie\\OneDrive\\Documents\\UNI\\SIT223 - Professional Practice\\Jenkins'
        TESTING_ENVIRONMENT = 'Pipeline test'
        PRODUCTION_ENVIRONMENT = 'Daniel Mattioli'
    }
    stages {
        stage('Build') {
            steps {
                echo "Build the code using a build automation tool (e.g., Maven) to compile and package the code."
                echo "Tool used: Maven"
            }
        }
        stage('Unit and Integration Tests') {
            steps {
                script {
                    // Capture log output to a file
                    def logFile = 'unit_integration_tests.log'
                    def log = sh(script: 'echo "Running unit and integration tests"; echo "Test logs here..."', returnStdout: true)
                    writeFile(file: logFile, text: log)
                }
            }
            post {
                success {
                    mail to: "danielmattioli2005@gmail.com",
                        subject: "Unit and Integration Tests Successful",
                        body: "The unit and integration tests were successful. Please check the attached log file.",
                        attachLog: false
                }
                failure {
                    mail to: "danielmattioli2005@gmail.com",
                        subject: "Unit and Integration Tests Failed",
                        body: "The unit and integration tests failed. Please check the attached log file.",
                        attachLog: false
                }
            }
        }
        stage('Code Analysis') {
            steps {
                echo "Integrate a code analysis tool to analyze the code and ensure it meets industry standards."
                echo "Tool used: SonarQube"
            }
        }
        stage('Security Scan') {
            steps {
                script {
                    // Capture log output to a file
                    def logFile = 'security_scan.log'
                    def log = sh(script: 'echo "Running security scan"; echo "Security scan logs here..."', returnStdout: true)
                    writeFile(file: logFile, text: log)
                }
            }
            post {
                success {
                    mail to: "danielmattioli2005@gmail.com",
                        subject: "Security Scan Successful",
                        body: "The security scan was successful. Please check the attached log file.",
                        attachLog: false
                }
                failure {
                    mail to: "danielmattioli2005@gmail.com",
                        subject: "Security Scan Failed",
                        body: "The security scan failed. Please check the attached log file.",
                        attachLog: false
                }
            }
        }
        stage('Deploy to Staging') {
            steps {
                echo "Deploy the application to a staging server (e.g., AWS EC2 instance)."
            }
        }
        stage('Integration Tests on Staging') {
            steps {
                echo "Run integration tests on the staging environment to ensure the application functions as expected in a production-like environment."
                echo "Tool used: Selenium"
            }
        }
        stage('Deploy to Production') {
            steps {
                echo "Deploy the application to a production server (e.g., AWS EC2 instance)."
                echo "Deployment environment: ${env.PRODUCTION_ENVIRONMENT}"
            }
        }
    }
}
